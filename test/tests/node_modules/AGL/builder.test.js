'use strict';

var assert     = require('assert');
var mockery    = require('mockery');

var mockObject = require('AGL/mock/mockObject');
var builder    = require('AGL/builder');

describe('builder', function () {

	// Mocks

	var validationMock = mockObject.NewMockObject();
	validationMock.Mock('Validate', undefined);

	// Setup

	before(function () {
		mockery.enable();
	});

	beforeEach(function () {
		mockery.registerMock('AGL/validation', validationMock);
	});

	// Teardown

	afterEach(function () {
		mockery.deregisterAll();
	});

	after(function () {
		mockery.disable();
	});

	// Tests

	describe('NewBuilder()', function () {

		it('should return an object when passed valid arguments', function () {
			var propertyMap = {
				prop1 : {
					required : true,
					type     : 'string' 
				}
			};
			assert(
				builder.NewBuilder(propertyMap, 'testObject') instanceof Object,
				'expected to return an object'
			)
		});

		it('should throw an error when objectName argument is missing', function () {
		});

		it('should throw an error when propertyMap argument is missing', function () {
		});

		describe('Property Map validation', function () {

			it('should throw an error when property is missing \'required\' flag', function () {
			});

			it('should throw an error when \'required\' flag is not a boolean value', function () {
			});

			it('should throw an error when propery is missing \'type\' property', function () {
			});

			it('should throw an error when \'required\' flag is false and there are no'
				+ ' \'default_value\' or \'database_default\' properties', function () {
			});

			it('should throw an error when a property has both a \'default_value\' and'
				+ ' a \'database_default\'', function () {
			});

			it('should throw an error if a \'database_default\' is included but'
				+ ' not set to true', function () {
			});

			it('should throw an error when a property has either a \'default_value\''
				+ ' or a \'database_default\' property when \'required\' is'
				+ ' set to true', function () {
			});

		});

	});

	describe('Builder Object', function () {

		it('should have a setter for each of its properties', function () {
		});

		it('should throw an error if Build() is called before OnValidationErrors()', function () {
		});

		it('should throw an error if OnValidationErrors() is not passed a function', function () {
		});

		it('should return an ImmutableObject when Build() is called', function () {
		});

		describe('ImmutableObject', function () {

			it('should have a getter for each of its properties', function () {
			});

		});

		it('should call validation error handler when validation fails', function () {
		});

		it('should pass the validation error handler an array of errors'
			+ ' when validation fails', function () {
		});

		it('should throw an error if Build() is called and required'
			+ ' properties have not been set', function () {
		});

		it('should set relevant properties to their defaults if they were unset', function () {
		});

		it('should set properties with database defaults to'
			+ ' undefined if they were unset', function () {
		});

		it('should reset after building an object', function () {
		});

	});

});
