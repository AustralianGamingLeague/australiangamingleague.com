'use strict';
//==============================================================================
//  Modules
//==============================================================================

var userAPI     = require('AGL/api/user');

//==============================================================================
//  Exports
//==============================================================================

module.exports = function (app) {

    // API routes

    UserAPIRoutes(app);

    // Front end routes

    app.get('*', function (request, response) {
        response.sendFile('index.html', {'root' : './public'});
    });
};

//==============================================================================
//  User API
//==============================================================================

function UserAPIRoutes(app) {

    // TODO Read up on RESTful APIs before going further. eg. This should be a POST, not GET.
    // TODO This block is pretty generic, encapsulate this into it's own function.
    app.post('/api/users', function (request, response) {

        var properties = request.body;
        userAPI.CreateUser(properties, function UserCreated(error, data) {
            var APIResponse;
            if (error) {
                console.log("ERROR: " + error);
                APIResponse = { error : error };
            }
            else {
                APIResponse = data;
            }
            response.json(APIResponse);
        });

    });

}

