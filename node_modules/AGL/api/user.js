 /*
 *  @file Handles logic for the user API
 *  @author Matt Lambert
 */

'use strict';
//==============================================================================
//  Modules
//==============================================================================

var validate    = require('validate.js');

var userFactory     = require('AGL/user/factory');
var userRepository  = require('AGL/user/repository');

//==============================================================================
//  Public Functions
//==============================================================================

/*
 *  public undefined CreateUser(properties, callback)
 *
 *  Creates a new user from the provided properties
 *  and saves it to the database.
 *  Returns username to the callback if creation is successful.
 *  Returns and array of errors to the callback on error.
 *
 *  @param {object} properties - user properties
 *  @param {function} callback
 */
module.exports.CreateUser = function (properties, callback) {
	if (!validate.isFunction(callback)) {
		throw new Error('callback argument must be a function.');
	}

	var user = userFactory.BuildUser()
		.SetUsername(properties.username)
		.SetPasswordHash(properties.passwordHash)
		.SetEmail(properties.email)
		.OnValidationErrors(function HandleValidationErrors (errors) {
			return callback(errors);
		})
		.Build();

	userRepository.InsertUser(user, function UserInserted (error, username) {
		if (error) {
			return callback([error]);
		}
		else {
			return callback([], username);
		}
	});

};

// TODO
module.exports.GetUser = function (args, callback) {
	if (!validate.isFunction(callback)) {
		throw new Error('callback argument must be a function.');
	}

};

//==============================================================================
//  Private Functions
//==============================================================================

