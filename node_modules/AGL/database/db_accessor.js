'use strict';
//==============================================================================
//  Modules
//==============================================================================

var config  = require('AGL/config');
var knex   = require('knex')({
    debug       : config.development,
    client      : config.db.client,
    connection  : {
        socketPath  : config.db.socketPath,
        host        : config.db.host,
        user        : config.db.user,
        password    : config.db.password,
        database    : config.db.database,
    },
});

//==============================================================================
//  Public functions
//==============================================================================

//  public undefined SubmitQuery(query, results)
//
//  Sends caller a knex query builder object, takes it back and submits
//  a query with it, returning the results of the query in a callback.
//
//  USAGE:
//      var dbAccessor = require('db_accessor');
//
//      dbAccessor.SubmitQuery(
//          function BuildQuery (knex) {
//              return knex
//              .select('name')
//              .from('table')
//              .where({ id: 1 });
//          },
//          function Results (error, data) {
//              // Do something with data or handle error
//          }
//      );
//
//  @param {function} query - Build query with knex query builder
//  @param {function} results - Callback with results from query
//
module.exports.SubmitQuery = function (query, results) {
    if (typeof query !== 'function') {
        throw (new Error("query argument must be a function"));
    }
    if (typeof results !== 'function') {
        throw (new Error("results argument must be a function"));
    }

    query(knex).asCallback(results);
};
